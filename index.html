<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>课堂考勤</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:#f5f7fa;display:flex;justify-content:center;align-items:center;height:100vh;padding:20px}
    .card{background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.1);padding:32px;width:100%;max-width:400px;text-align:center}
    h1{margin-bottom:8px;font-size:24px;color:#303133}
    p{color:#909399;font-size:14px;margin-bottom:20px}
    .form-group{text-align:left;margin-bottom:16px}
    label{font-weight:600;font-size:14px;color:#606266;display:block;margin-bottom:6px}
    input{width:100%;padding:10px 12px;border:1px solid #dcdfe6;border-radius:6px;font-size:16px}
    .loc{background:#f4f4f5;border-radius:6px;padding:12px;font-size:13px;color:#606266;margin-bottom:20px}
    button{width:100%;background:#409eff;color:#fff;border:none;padding:12px 0;border-radius:6px;font-size:16px;font-weight:600;cursor:pointer}
    button:disabled{background:#a0cfff;cursor:not-allowed}
    .msg{margin-top:16px;font-size:14px;display:none}
    .success{color:#67c23a}.error{color:#f56c6c}
  </style>
</head>
<body>
  <div class="card">
    <h1>📌 课堂打卡</h1>
    <p>请填写信息并允许定位</p>
    <div class="form-group">
      <label>姓名</label>
      <input id="name" placeholder="请输入姓名" required>
    </div>
    <div class="form-group">
      <label>学号</label>
      <input id="sid" placeholder="请输入学号" required>
    </div>
    <div class="loc">
      定位状态：<span id="locStat">正在获取…</span>
    </div>
    <button id="btn" onclick="submit()">提交打卡</button>
    <div id="msg" class="msg"></div>
  </div>

  <script>
    let lat, lon, ts;
    /* 1. 获取位置 */
    navigator.geolocation.getCurrentPosition(
      ok=>{lat=ok.coords.latitude;lon=ok.coords.longitude;ts=new Date().toISOString();document.getElementById('locStat').textContent='✅ 已定位';},
      err=>{document.getElementById('locStat').textContent='❌ 无法定位';}
    );
    /* 2. 提交 */
    async function submit(){
      const n=document.getElementById('name').value.trim();
      const s=document.getElementById('sid').value.trim();
      const b=document.getElementById('btn');
      const m=document.getElementById('msg');
      if(!n||!s){show('请填写完整','error');return;}
      if(!lat||!lon){show('定位失败','error');return;}
      b.disabled=true; b.textContent='提交中…';
      try{
        await fetch('https://api.github.com/repos/zjzst/attendance/dispatches',{
          method:'POST',
          headers:{
            'Authorization':'Bearer github_pat_11XXXXXXXX', /* ③ 你的 token */
            'Content-Type':'application/json',
            'Accept':'application/vnd.github+json'
          },
          body:JSON.stringify({
            event_type:'attend',
            client_payload:{studentName:n,studentId:s,latitude:lat,longitude:lon,timestamp:ts}
          })
        });
        show('✅ 打卡成功！','success');
        document.getElementById('name').value='';
        document.getElementById('sid').value='';
      }catch(e){show('❌ 提交失败','error');}
      b.disabled=false; b.textContent='提交打卡';
    }
    function show(txt,t){const x=document.getElementById('msg');x.textContent=txt;x.className='msg '+t;x.style.display='block';}
  </script>
</body>
</html>